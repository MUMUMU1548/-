local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local Debris = game:GetService("Debris")
local lp = Players.LocalPlayer

local MY_NAME = lp.Name
local MY_DISPLAY_NAME = lp.DisplayName

local WHITELIST = {
    ["robloxtestscrip_4"] = true,
}

local function getChar()
    return lp.Character or lp.CharacterAdded:Wait()
end

local function isMe(name)
    name = string.lower(name or "")
    return name == string.lower(MY_NAME) or name == string.lower(MY_DISPLAY_NAME)
end

local function isAllowed(senderName)
    return WHITELIST[senderName] == true
end

-- ===== ACTIONS =====
local function killMe() local h=getChar():FindFirstChildOfClass("Humanoid"); if h then h.Health=0 end end
local function bringMe(senderName) local s=Players:FindFirstChild(senderName); if s and s.Character and s.Character:FindFirstChild("HumanoidRootPart") then getChar():WaitForChild("HumanoidRootPart").CFrame = s.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,-3) end end
local function freezeMe() getChar():WaitForChild("HumanoidRootPart").Anchored = true end
local function unfreezeMe() getChar():WaitForChild("HumanoidRootPart").Anchored = false end
local function jailMe() local c=getChar(); local hrp=c:WaitForChild("HumanoidRootPart"); local old=workspace:FindFirstChild("JAIL_"..MY_NAME); if old then old:Destroy() end; local cage=Instance.new("Part"); cage.Name="JAIL_"..MY_NAME; cage.Size=Vector3.new(8,8,8); cage.CFrame=hrp.CFrame; cage.Anchored=true; cage.CanCollide=true; cage.Material=Enum.Material.Glass; cage.Transparency=0.6; cage.Color=Color3.fromRGB(120,200,255); cage.Parent=workspace; hrp.CFrame=cage.CFrame; freezeMe() end
local function unjailMe() local old=workspace:FindFirstChild("JAIL_"..MY_NAME); if old then old:Destroy() end; unfreezeMe() end
local function explodeMe() local c=getChar(); local hrp=c:WaitForChild("HumanoidRootPart"); local ex=Instance.new("Explosion"); ex.Position=hrp.Position; ex.BlastRadius=14; ex.BlastPressure=500000; ex.DestroyJointRadiusPercent=0; ex.Parent=workspace; local smoke=Instance.new("Smoke"); smoke.Size=25; smoke.RiseVelocity=10; smoke.Opacity=0.8; smoke.Color=Color3.fromRGB(180,180,180); smoke.Parent=hrp; Debris:AddItem(smoke,3) end

-- ===== COMMAND HANDLER =====
local function handleCommand(text,senderName)
    if not isAllowed(senderName) then return end
    local lower=string.lower(text or "")
    local cmd,target=string.match(lower,"^;(%w+)%s*:%s*(.+)$")
    if not cmd then cmd,target=string.match(lower,"^(%w+)%s+(.+)$") end
    if not cmd or not isMe(target) then return end
    if cmd=="kill" then killMe() elseif cmd=="bring" then bringMe(senderName)
    elseif cmd=="freeze" then freezeMe() elseif cmd=="unfreeze" then unfreezeMe()
    elseif cmd=="jail" then jailMe() elseif cmd=="unjail" then unjailMe()
    elseif cmd=="explode" then explodeMe() end
end

lp.Chatted:Connect(function(msg) handleCommand(msg, MY_NAME) end)
pcall(function() TextChatService.MessageReceived:Connect(function(msg) local sender=msg.TextSource and msg.TextSource.Name or ""; handleCommand(msg.Text,sender) end) end)

-- ===== 2 UI =====
if WHITELIST[MY_NAME] then
    local function sendChat(msg) pcall(function() TextChatService.TextChannels.RBXGeneral:SendAsync(msg) end) end
    local SelectedPlayer = nil

    -- UI 1: Player List
    local gui1=Instance.new("ScreenGui",game.CoreGui)
    gui1.Name="PlayerSelector"
    local frame1=Instance.new("Frame",gui1)
    frame1.Size=UDim2.fromScale(0.25,0.4)
    frame1.Position=UDim2.fromScale(0.05,0.2)
    frame1.BackgroundColor3=Color3.fromRGB(40,120,200)
    frame1.Active=true frame1.Draggable=true
    Instance.new("UICorner",frame1).CornerRadius=UDim.new(0,16)
    local title1=Instance.new("TextLabel",frame1)
    title1.Size=UDim2.fromScale(1,0.12)
    title1.BackgroundTransparency=1
    title1.Text="PLAYERS"
    title1.TextColor3=Color3.new(1,1,1)
    title1.TextScaled=true
    title1.Font=Enum.Font.GothamBold

    local function updatePlayerList()
        for _,v in ipairs(frame1:GetChildren()) do
            if v:IsA("TextButton") and v.Name=="PLAYERBTN" then v:Destroy() end
        end
        local y=0.14
        for _,plr in ipairs(Players:GetPlayers()) do
            local b=Instance.new("TextButton",frame1)
            b.Name="PLAYERBTN"
            b.Size=UDim2.fromScale(0.9,0.06)
            b.Position=UDim2.fromScale(0.05,y)
            y+=0.07
            b.Text=plr.Name
            b.TextScaled=true
            b.Font=Enum.Font.Gotham
            b.TextColor3=Color3.new(1,1,1)
            b.BackgroundColor3=Color3.fromRGB(20,90,160)
            b.BorderSizePixel=0
            Instance.new("UICorner",b).CornerRadius=UDim.new(0,12)
            b.MouseButton1Click:Connect(function() SelectedPlayer=plr.Name end)
        end
    end
    updatePlayerList()
    Players.PlayerAdded:Connect(updatePlayerList)
    Players.PlayerRemoving:Connect(updatePlayerList)

    -- UI 2: Commands
    local gui2=Instance.new("ScreenGui",game.CoreGui)
    gui2.Name="CommandPanel"
    local frame2=Instance.new("Frame",gui2)
    frame2.Size=UDim2.fromScale(0.25,0.45)
    frame2.Position=UDim2.fromScale(0.35,0.2)
    frame2.BackgroundColor3=Color3.fromRGB(40,120,200)
    frame2.Active=true frame2.Draggable=true
    Instance.new("UICorner",frame2).CornerRadius=UDim.new(0,16)
    local title2=Instance.new("TextLabel",frame2)
    title2.Size=UDim2.fromScale(1,0.12)
    title2.BackgroundTransparency=1
    title2.Text="COMMANDS"
    title2.TextColor3=Color3.new(1,1,1)
    title2.TextScaled=true
    title2.Font=Enum.Font.GothamBold

    local commands={
        {name="KILL", cmd=";kill:"},
        {name="BRING", cmd=";bring:"},
        {name="FREEZE", cmd=";freeze:"},
        {name="UNFREEZE", cmd=";unfreeze:"},
        {name="JAIL", cmd=";jail:"},
        {name="UNJAIL", cmd=";unjail:"},
        {name="EXPLODE", cmd=";explode:"},
    }

    local yStart=0.14
    for i,v in ipairs(commands) do
        local b=Instance.new("TextButton",frame2)
        b.Size=UDim2.fromScale(0.9,0.06)
        b.Position=UDim2.fromScale(0.05,yStart+(i-1)*0.07)
        b.Text=v.name
        b.TextScaled=true
        b.Font=Enum.Font.GothamBold
        b.TextColor3=Color3.new(1,1,1)
        b.BackgroundColor3=Color3.fromRGB(25,120,200)
        b.BorderSizePixel=0
        Instance.new("UICorner",b).CornerRadius=UDim.new(0,12)
        b.MouseButton1Click:Connect(function()
            if SelectedPlayer then sendChat(v.cmd..SelectedPlayer) end
        end)
    end
end

print("SYSTEM READY")
