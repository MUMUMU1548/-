-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer


local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

local Window = WindUI:CreateWindow({
    Title = "ERROR HUB",
    Icon = "rbxassetid://108455308252343", 
    Author = "",
    Folder = "ERROR HUB",
    Size = UDim2.fromOffset(450, 330),
    Theme = "Violet", 
    Transparent = true,
    Resizable = true,
})

Window:EditOpenButton({ Enabled = false }) 

local ScreenGui = Instance.new("ScreenGui")
local ToggleBtn = Instance.new("ImageButton")
local UICorner = Instance.new("UICorner") 

ScreenGui.Name = "ERROR HUB"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

ToggleBtn.Size = UDim2.new(0, 50, 0, 50)
ToggleBtn.Position = UDim2.new(0, 20, 0.5, -25)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
ToggleBtn.BackgroundTransparency = 0
ToggleBtn.Image = "rbxassetid://108455308252343"
ToggleBtn.Active = true
ToggleBtn.Draggable = true
ToggleBtn.Parent = ScreenGui

UICorner.CornerRadius = UDim.new(0, 12) 
UICorner.Parent = ToggleBtn

local opened = true

local function toggle()
    opened = not opened
    if Window.UI then
        Window.UI.Enabled = opened
    else
        Window:Toggle()
    end
end

ToggleBtn.MouseButton1Click:Connect(function()
    ToggleBtn:TweenSize(
        UDim2.new(0, 56, 0, 56),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.12,
        true,
        function()
            ToggleBtn:TweenSize(
                UDim2.new(0, 50, 0, 50),
                Enum.EasingDirection.Out,
                Enum.EasingStyle.Quad,
                0.12,
                true
            )
        end
    )
    toggle()
end)

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.T then
        toggle()
    end
end)


-- STATE
local enabled = false
local speedLevel = 1
local speedValue = 60
local loopConnection = nil

-- คำนวณความเร็วจาก Slider
local function updateSpeed()
    speedValue = speedLevel * 60
end
updateSpeed()

-- ===== CORE =====

local function GetDirection()
    local char = player.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if hum then
        return hum.MoveDirection
    end
end

local function ApplyMove(offset)
    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if root and hum then
        hum:ChangeState(Enum.HumanoidStateType.Physics)
        root.AssemblyLinearVelocity = Vector3.zero
        root.CFrame = root.CFrame + offset
    end
end

local function ConnectLoop(fn)
    return RunService.RenderStepped:Connect(fn)
end

local function toggleMovement(on)
    enabled = on
    if loopConnection then
        loopConnection:Disconnect()
        loopConnection = nil
    end

    if on then
        loopConnection = ConnectLoop(function(dt)
            local dir = GetDirection()
            if dir and dir.Magnitude > 0 then
                ApplyMove(dir.Unit * (speedValue * dt))
            end
        end)
    end
end


local MainTab = Window:Tab({Title = "MAIN", Icon = "user"})

MainTab:Toggle({
    Title = "walk speed",
    Default = false,
    Callback = function(v)
        toggleMovement(v)
    end
})

MainTab:Slider({
    Title = "Speed",
    Step = 1,
    Value = {
        Min = 1,
        Max = 5,
        Default = 1
    },
    Callback = function(v)
        speedLevel = tonumber(v) or 1
        updateSpeed()
    end
})
